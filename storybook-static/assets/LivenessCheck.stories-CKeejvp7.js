import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{r as c}from"./index-DmM0KDA7.js";import{G as I,D as M}from"./global-BfAsUHpc.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var b=function(e,s){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,n){a.__proto__=n}||function(a,n){for(var r in n)n.hasOwnProperty(r)&&(a[r]=n[r])},b(e,s)};function H(e,s){b(e,s);function a(){this.constructor=e}e.prototype=s===null?Object.create(s):(a.prototype=s.prototype,new a)}var j=function(){return j=Object.assign||function(s){for(var a,n=1,r=arguments.length;n<r;n++){a=arguments[n];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(s[o]=a[o])}return s},j.apply(this,arguments)};function q(e,s){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&s.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)s.indexOf(n[r])<0&&(a[n[r]]=e[n[r]]);return a}var X=100,A=100,O=50,C=50,w=50;function _(e){var s=e.className,a=e.counterClockwise,n=e.dashRatio,r=e.pathRadius,o=e.strokeWidth,l=e.style;return c.createElement("path",{className:s,style:Object.assign({},l,z({pathRadius:r,dashRatio:n,counterClockwise:a})),d:G({pathRadius:r,counterClockwise:a}),strokeWidth:o,fillOpacity:0})}function G(e){var s=e.pathRadius,a=e.counterClockwise,n=s,r=a?1:0;return`
      M `+C+","+w+`
      m 0,-`+n+`
      a `+n+","+n+" "+r+" 1 1 0,"+2*n+`
      a `+n+","+n+" "+r+" 1 1 0,-"+2*n+`
    `}function z(e){var s=e.counterClockwise,a=e.dashRatio,n=e.pathRadius,r=Math.PI*2*n,o=(1-a)*r;return{strokeDasharray:r+"px "+r+"px",strokeDashoffset:(s?-o:o)+"px"}}var F=function(e){H(s,e);function s(){return e!==null&&e.apply(this,arguments)||this}return s.prototype.getBackgroundPadding=function(){return this.props.background?this.props.backgroundPadding:0},s.prototype.getPathRadius=function(){return O-this.props.strokeWidth/2-this.getBackgroundPadding()},s.prototype.getPathRatio=function(){var a=this.props,n=a.value,r=a.minValue,o=a.maxValue,l=Math.min(Math.max(n,r),o);return(l-r)/(o-r)},s.prototype.render=function(){var a=this.props,n=a.circleRatio,r=a.className,o=a.classes,l=a.counterClockwise,d=a.styles,f=a.strokeWidth,u=a.text,h=this.getPathRadius(),g=this.getPathRatio();return c.createElement("svg",{className:o.root+" "+r,style:d.root,viewBox:"0 0 "+X+" "+A,"data-test-id":"CircularProgressbar"},this.props.background?c.createElement("circle",{className:o.background,style:d.background,cx:C,cy:w,r:O}):null,c.createElement(_,{className:o.trail,counterClockwise:l,dashRatio:n,pathRadius:h,strokeWidth:f,style:d.trail}),c.createElement(_,{className:o.path,counterClockwise:l,dashRatio:g*n,pathRadius:h,strokeWidth:f,style:d.path}),u?c.createElement("text",{className:o.text,style:d.text,x:C,y:w},u):null)},s.defaultProps={background:!1,backgroundPadding:0,circleRatio:1,classes:{root:"CircularProgressbar",trail:"CircularProgressbar-trail",path:"CircularProgressbar-path",text:"CircularProgressbar-text",background:"CircularProgressbar-background"},counterClockwise:!1,className:"",maxValue:100,minValue:0,strokeWidth:8,styles:{root:{},trail:{},path:{},text:{},background:{}},text:""},s}(c.Component);function U(e){e.children;var s=q(e,["children"]);return c.createElement("div",{"data-test-id":"CircularProgressbarWithChildren"},c.createElement("div",{style:{position:"relative",width:"100%",height:"100%"}},c.createElement(F,j({},s)),e.children?c.createElement("div",{"data-test-id":"CircularProgressbarWithChildren__children",style:{position:"absolute",width:"100%",height:"100%",marginTop:"-100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},e.children):null))}function Z(e){var s=e.rotation,a=e.strokeLinecap,n=e.textColor,r=e.textSize,o=e.pathColor,l=e.pathTransition,d=e.pathTransitionDuration,f=e.trailColor,u=e.backgroundColor,h=s==null?void 0:"rotate("+s+"turn)",g=s==null?void 0:"center center";return{root:{},path:k({stroke:o,strokeLinecap:a,transform:h,transformOrigin:g,transition:l,transitionDuration:d==null?void 0:d+"s"}),trail:k({stroke:f,strokeLinecap:a,transform:h,transformOrigin:g}),text:k({fill:n,fontSize:r}),background:k({fill:u})}}function k(e){return Object.keys(e).forEach(function(s){e[s]==null&&delete e[s]}),e}function J(e){return I({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M0 4.75C0 3.784.784 3 1.75 3h20.5c.966 0 1.75.784 1.75 1.75v14.5A1.75 1.75 0 0 1 22.25 21H1.75A1.75 1.75 0 0 1 0 19.25Zm1.75-.25a.25.25 0 0 0-.25.25v14.5c0 .138.112.25.25.25h20.5a.25.25 0 0 0 .25-.25V4.75a.25.25 0 0 0-.25-.25Z"},child:[]},{tag:"path",attr:{d:"M9 15.584V8.416a.5.5 0 0 1 .77-.42l5.576 3.583a.5.5 0 0 1 0 .842L9.77 16.005a.5.5 0 0 1-.77-.42Z"},child:[]}]})(e)}const V=c.forwardRef(({setMessage:e,setError:s,setOpenDialog:a,title:n,setResult:r},o)=>{const[l,d]=c.useState(!1),f=c.useRef(null),u=c.useRef(null),[h,g]=c.useState("Waiting for instructions...");return c.useEffect(()=>{if(l)return u.current=new WebSocket("wss://tani-face-model-77573755128.us-central1.run.app/real-time-liveliness-detection"),u.current.onopen=()=>{},u.current.onmessage=i=>{var v;const m=JSON.parse(i.data);m.instruction&&g(m.instruction),m.results&&(g("Liveness detection completed!"),r(m.results),(v=u.current)==null||v.close(),a(!0),e("Liveness detection completed!"),d(!1)),m.error&&(s==null||s(m.error))},u.current.onclose=()=>{},u.current.onerror=i=>{},()=>{var i;(i=u.current)==null||i.close()}},[l]),c.useEffect(()=>{if(!l)return;const i=f.current;if(!i)return;navigator.mediaDevices.getUserMedia({video:!0}).then(p=>{i.srcObject=p,i.onloadedmetadata=()=>{i.play(),console.log("Webcam stream loaded."),R()}}).catch(p=>{console.error("Error accessing webcam:",p),alert("Please allow access to your webcam.")});const m=document.createElement("canvas"),v=m.getContext("2d");if(!v)return;const R=()=>{var N;if(!i.videoWidth||!i.videoHeight)return;m.width=i.videoWidth,m.height=i.videoHeight,v.drawImage(i,0,0,m.width,m.height);const p=m.toDataURL("image/jpeg");if(p==="data:,"){console.warn("Empty frame captured. Skipping...");return}((N=u.current)==null?void 0:N.readyState)===WebSocket.OPEN&&u.current.send(JSON.stringify({frame:p})),setTimeout(R,200)};return()=>{i.srcObject&&i.srcObject.getTracks().forEach(p=>p.stop())}},[l]),t.jsxs("div",{className:"mx-auto max-w-xl p-8",children:[t.jsx("h5",{children:n||"Record Video"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Click to open the camera module and allow the browser to access your camera."}),t.jsx(t.Fragment,{children:l?t.jsxs("div",{className:"mt-5",children:[t.jsx("div",{className:"relative flex items-center justify-center",id:"container",children:t.jsx("div",{className:"h-full w-3/4",children:t.jsx(U,{value:h==="Please open your mouth"?33.33:h==="Please move your head"?66.66:h==="Liveness detection completed!"?100:0,strokeWidth:3,styles:Z({pathColor:"#4327B2",trailColor:"#D3D3D3",strokeLinecap:"round"}),children:t.jsx("video",{ref:f,autoPlay:!0,className:"w-full scale-[1.33]",style:{clipPath:"circle(40%)"}})})})}),t.jsx("p",{className:"my-4 text-center text-lg text-gray-700",children:h}),t.jsx("button",{className:"mx-auto block py-2 text-white bg-[#4327B2] border-[#4327B2] border-[1px] px-5 rounded-md cursor-pointer",onClick:i=>{i.preventDefault(),i.stopPropagation(),d(!1)},children:"Close Liveness"})]}):t.jsxs("div",{className:"relative mt-5 flex min-h-[300px] flex-col items-center justify-center rounded-md border border-gray-300 bg-white p-8",children:[t.jsx(J,{size:70,className:"text-gray-500"}),t.jsx("div",{className:"mt-3 text-center",children:t.jsx("p",{className:"text-gray-700",children:t.jsx("span",{className:"text-[#4327B2] cursor-pointer font-semibold",children:"Click on open camera to start recording"})})}),t.jsx("div",{className:"mt-5 flex w-full flex-col items-center gap-2 md:flex-row",children:t.jsx("button",{onClick:i=>{i.preventDefault(),i.stopPropagation(),d(!0)},className:"flex-grow basis-10 md:basis-10 hover:bg-[#B9AEE7] text-[#4327B2] border-[#4327B2] border-[1px] px-4 py-2 rounded-md cursor-pointer",children:"Open Camera"})})]})})]})});V.__docgenInfo={description:"",methods:[],displayName:"VidWebCam",props:{title:{required:!1,tsType:{name:"string"},description:""},setMessage:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string | null) => void",signature:{arguments:[{type:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},name:"value"}],return:{name:"void"}}},description:""},setError:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string | null) => void",signature:{arguments:[{type:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},name:"value"}],return:{name:"void"}}},description:""},setOpenDialog:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"value"}],return:{name:"void"}}},description:""},setResult:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: LivenessDetection | null) => void",signature:{arguments:[{type:{name:"union",raw:"LivenessDetection | null",elements:[{name:"signature",type:"object",raw:`{\r
  blink_detected: boolean;\r
  mouth_open_detected: boolean;\r
  head_movement_detected: boolean;\r
  is_live: boolean;\r
}`,signature:{properties:[{key:"blink_detected",value:{name:"boolean",required:!0}},{key:"mouth_open_detected",value:{name:"boolean",required:!0}},{key:"head_movement_detected",value:{name:"boolean",required:!0}},{key:"is_live",value:{name:"boolean",required:!0}}]}},{name:"null"}]},name:"value"}],return:{name:"void"}}},description:""}}};const P=()=>{const[e,s]=c.useState(null),[a,n]=c.useState(null),[r,o]=c.useState(null),[l,d]=c.useState(!1);return t.jsxs("main",{className:"flex w-full flex-col relative",children:[t.jsx("h1",{children:"Liveness Check"}),t.jsxs("ul",{className:"mt-3 list-inside list-disc text-gray-500",children:[t.jsxs("li",{children:[" ","Click on the ",t.jsx("strong",{children:"Record Face"})," button to open the camera module."]}),t.jsx("li",{children:" Please make sure you allow the browser to access your camera."}),t.jsxs("li",{children:[" ","Record a video of your face and click the ",t.jsx("strong",{children:"Record"})," ","button to check your liveness."]})]}),t.jsx("div",{className:"flex-1",children:t.jsx(V,{title:"Start liveness check",setMessage:s,setError:n,setOpenDialog:d,setResult:o})}),l&&t.jsxs(M,{closeDialog:()=>{d(!1)},children:[t.jsx("div",{className:"flex justify-center p-6",children:e&&t.jsxs("div",{className:"relative flex h-52 w-full px-6 flex-col items-center justify-center rounded-md bg-white",children:[t.jsx("h5",{className:"mb-2 text-center",children:e}),t.jsxs("div",{children:[t.jsxs("div",{children:[t.jsx("span",{children:t.jsx("input",{type:"radio",checked:r==null?void 0:r.blink_detected})})," ",t.jsx("span",{children:"Eyes Blink"})]}),t.jsxs("div",{children:[t.jsx("span",{children:t.jsx("input",{type:"radio",checked:r==null?void 0:r.mouth_open_detected})})," ",t.jsx("span",{children:"Mouth Open"})]}),t.jsxs("div",{children:[t.jsx("span",{children:t.jsx("input",{type:"radio",checked:r==null?void 0:r.head_movement_detected})})," ",t.jsx("span",{children:"Head Movement"})]}),t.jsxs("div",{children:[t.jsx("span",{children:t.jsx("input",{type:"radio",checked:r==null?void 0:r.is_live})})," ",t.jsx("span",{children:"Live"})]})]})]})}),a!==null&&t.jsx("div",{className:"text-center",children:t.jsx("h5",{className:"",children:a})})]})]})};P.__docgenInfo={description:"",methods:[],displayName:"LivenessCheck"};const $={title:"ReactComponentLibrary/livenessCheck",component:P},B=()=>t.jsx(P,{}),x=B.bind({});x.args={title:"Default theme",theme:"primary",testIdPrefix:"liveness"};const y=B.bind({});y.args={title:"Secondary theme",theme:"secondary",testIdPrefix:"liveness"};var E,L,W;x.parameters={...x.parameters,docs:{...(E=x.parameters)==null?void 0:E.docs,source:{originalSource:"() => <LivenessCheck />",...(W=(L=x.parameters)==null?void 0:L.docs)==null?void 0:W.source}}};var D,S,T;y.parameters={...y.parameters,docs:{...(D=y.parameters)==null?void 0:D.docs,source:{originalSource:"() => <LivenessCheck />",...(T=(S=y.parameters)==null?void 0:S.docs)==null?void 0:T.source}}};const ee=["LivenessTest","LivenessSecondary"];export{y as LivenessSecondary,x as LivenessTest,ee as __namedExportsOrder,$ as default};
